<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TP6.Views.ProfilePage"
             Title="Profil">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Light mode colors -->
            <Color x:Key="LightBackground">#F5F5F5</Color>
            <Color x:Key="LightCardBackground">#FFFFFF</Color>
            <Color x:Key="LightTextPrimary">#1A1A1A</Color>
            <Color x:Key="LightTextSecondary">#666666</Color>
            <Color x:Key="LightInputBackground">#FFFFFF</Color>

            <!-- Dark mode colors -->
            <Color x:Key="DarkBackground">#121212</Color>
            <Color x:Key="DarkCardBackground">#1E1E1E</Color>
            <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
            <Color x:Key="DarkTextSecondary">#B0B0B0</Color>
            <Color x:Key="DarkInputBackground">#2C2C2C</Color>

            <!-- Accent colors -->
            <Color x:Key="PrimaryColor">#3498DB</Color>
            <Color x:Key="DangerColor">#E74C3C</Color>
            <Color x:Key="SuccessColor">#27AE60</Color>
            <Color x:Key="SecondaryColor">#95A5A6</Color>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ScrollView>
        <StackLayout Padding="20" Spacing="20">

            <!-- Profile Avatar -->
            <Frame WidthRequest="100" HeightRequest="100"
                   CornerRadius="50"
                   HorizontalOptions="Center"
                   HasShadow="True"
                   BackgroundColor="{StaticResource PrimaryColor}">
                <Label Text="👤"
                       FontSize="50"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       TextColor="White" />
            </Frame>

            <!-- User Name and Edit Button -->
            <StackLayout Spacing="10">
                <Label Text="{Binding CurrentUser.FullName}"
                       FontSize="24"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       Margin="0,0,0,5">
                    <Label.TextColor>
                        <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                    </Label.TextColor>
                </Label>

                <Button Text="✏️ Modifier profil"
                        BackgroundColor="{StaticResource DangerColor}"
                        TextColor="White"
                        FontSize="14"
                        FontAttributes="Bold"
                        CornerRadius="20"
                        WidthRequest="150"
                        HeightRequest="40"
                        HorizontalOptions="Center"
                        Command="{Binding StartEditCommand}" />
            </StackLayout>
            
            <!-- Edit Form -->
            <Frame IsVisible="{Binding IsEditing}"
                   Padding="20"
                   CornerRadius="12"
                   HasShadow="True">
                <Frame.BackgroundColor>
                    <AppThemeBinding Light="{StaticResource LightCardBackground}" Dark="{StaticResource DarkCardBackground}" />
                </Frame.BackgroundColor>

                <StackLayout Spacing="15">
                    <Label Text="Prénom"
                           FontSize="14"
                           FontAttributes="Bold">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                        </Label.TextColor>
                    </Label>
                    <Entry Text="{Binding EditFirstName}"
                           FontSize="16">
                        <Entry.BackgroundColor>
                            <AppThemeBinding Light="{StaticResource LightInputBackground}" Dark="{StaticResource DarkInputBackground}" />
                        </Entry.BackgroundColor>
                        <Entry.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                        </Entry.TextColor>
                    </Entry>

                    <Label Text="Nom"
                           FontSize="14"
                           FontAttributes="Bold">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                        </Label.TextColor>
                    </Label>
                    <Entry Text="{Binding EditLastName}"
                           FontSize="16">
                        <Entry.BackgroundColor>
                            <AppThemeBinding Light="{StaticResource LightInputBackground}" Dark="{StaticResource DarkInputBackground}" />
                        </Entry.BackgroundColor>
                        <Entry.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                        </Entry.TextColor>
                    </Entry>

                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="10" Margin="0,10,0,0">
                        <Button Text="✓ Sauvegarder"
                                BackgroundColor="{StaticResource SuccessColor}"
                                TextColor="White"
                                FontSize="14"
                                CornerRadius="8"
                                WidthRequest="140"
                                Command="{Binding SaveProfileCommand}" />

                        <Button Text="✕ Annuler"
                                BackgroundColor="{StaticResource SecondaryColor}"
                                TextColor="White"
                                FontSize="14"
                                CornerRadius="8"
                                WidthRequest="110"
                                Command="{Binding CancelEditCommand}" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Statistics Section -->
            <Frame Padding="20"
                   CornerRadius="12"
                   HasShadow="True">
                <Frame.BackgroundColor>
                    <AppThemeBinding Light="{StaticResource LightCardBackground}" Dark="{StaticResource DarkCardBackground}" />
                </Frame.BackgroundColor>

                <StackLayout Spacing="12">
                    <Label Text="📊 Statistiques"
                           FontSize="18"
                           FontAttributes="Bold">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                        </Label.TextColor>
                    </Label>

                    <Label Text="{Binding NotesCount, StringFormat='📝 {0} notes créées'}"
                           FontSize="16">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                        </Label.TextColor>
                    </Label>

                    <Label Text="{Binding MemberSinceDays}"
                           FontSize="16">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                        </Label.TextColor>
                    </Label>
                </StackLayout>
            </Frame>

            <!-- Settings Section -->
            <Frame Padding="20"
                   CornerRadius="12"
                   HasShadow="True">
                <Frame.BackgroundColor>
                    <AppThemeBinding Light="{StaticResource LightCardBackground}" Dark="{StaticResource DarkCardBackground}" />
                </Frame.BackgroundColor>

                <StackLayout Spacing="15">
                    <Label Text="⚙️ Paramètres"
                           FontSize="18"
                           FontAttributes="Bold"
                           Margin="0,0,0,5">
                        <Label.TextColor>
                            <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                        </Label.TextColor>
                    </Label>

                    <!-- Notifications Toggle -->
                    <Frame Padding="12"
                           CornerRadius="8"
                           HasShadow="False"
                           BorderColor="#E0E0E0">
                        <Frame.BackgroundColor>
                            <AppThemeBinding Light="{StaticResource LightInputBackground}" Dark="{StaticResource DarkInputBackground}" />
                        </Frame.BackgroundColor>

                        <StackLayout Orientation="Horizontal">
                            <Label Text="🔔"
                                   FontSize="24"
                                   VerticalOptions="Center" />
                            <StackLayout VerticalOptions="Center" Spacing="2" HorizontalOptions="StartAndExpand" Margin="10,0,0,0">
                                <Label Text="Notifications"
                                       FontSize="16"
                                       FontAttributes="Bold">
                                    <Label.TextColor>
                                        <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                                    </Label.TextColor>
                                </Label>
                                <Label Text="Recevoir des notifications"
                                       FontSize="12">
                                    <Label.TextColor>
                                        <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                                    </Label.TextColor>
                                </Label>
                            </StackLayout>
                            <Switch IsToggled="{Binding CurrentUser.NotificationsEnabled}"
                                    VerticalOptions="Center"
                                    OnColor="{StaticResource PrimaryColor}"
                                    Toggled="OnNotificationsToggled" />
                        </StackLayout>
                    </Frame>

                    <!-- Dark Mode Toggle -->
                    <Frame Padding="12"
                           CornerRadius="8"
                           HasShadow="False"
                           BorderColor="#E0E0E0">
                        <Frame.BackgroundColor>
                            <AppThemeBinding Light="{StaticResource LightInputBackground}" Dark="{StaticResource DarkInputBackground}" />
                        </Frame.BackgroundColor>

                        <StackLayout Orientation="Horizontal">
                            <Label Text="🌙"
                                   FontSize="24"
                                   VerticalOptions="Center" />
                            <StackLayout VerticalOptions="Center" Spacing="2" HorizontalOptions="StartAndExpand" Margin="10,0,0,0">
                                <Label Text="Mode sombre"
                                       FontSize="16"
                                       FontAttributes="Bold">
                                    <Label.TextColor>
                                        <AppThemeBinding Light="{StaticResource LightTextPrimary}" Dark="{StaticResource DarkTextPrimary}" />
                                    </Label.TextColor>
                                </Label>
                                <Label Text="Thème sombre pour l'application"
                                       FontSize="12">
                                    <Label.TextColor>
                                        <AppThemeBinding Light="{StaticResource LightTextSecondary}" Dark="{StaticResource DarkTextSecondary}" />
                                    </Label.TextColor>
                                </Label>
                            </StackLayout>
                            <Switch IsToggled="{Binding CurrentUser.DarkModeEnabled}"
                                    VerticalOptions="Center"
                                    OnColor="{StaticResource PrimaryColor}"
                                    Toggled="OnDarkModeToggled" />
                        </StackLayout>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Back Button -->
            <Button Text="⬅️ Retour"
                    BackgroundColor="{StaticResource PrimaryColor}"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    CornerRadius="12"
                    HeightRequest="50"
                    Margin="0,10,0,20"
                    Command="{Binding GoBackCommand}" />
                    
        </StackLayout>
    </ScrollView>
</ContentPage>
